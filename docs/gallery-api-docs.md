# Gallery API Documentation

## Overview
The gallery endpoints provide access to all generated media content including videos with their associated audio files, scripts, and SRT subtitles, as well as images with their prompts. These endpoints require authentication and are only accessible to users with Creator or PRO roles.

## Base URL
- **Local Development**: `http://localhost:3001`
- **Production**: `https://realculture-backend-g3b9deb2fja4b8a2.canadacentral-01.azurewebsites.net`

## Authentication
All gallery endpoints require a valid JWT token in the `Authorization` header:
```
Authorization: Bearer {access_token}
```

## Endpoints

### 1. Get User Gallery
Retrieves all media content generated by the user within the subscription period (last 30 days).

```
GET /api/gallery
```

#### Response
```json
[
  {
    "id": "string",
    "title": "string",
    "description": "string",
    "type": "image|audio|video|text|other",
    "createdAt": "2023-01-01T00:00:00.000Z",
    "sasUrl": "string|null",
    "previewUrl": "string|null"
  }
]
```

#### Response Fields
| Field | Type | Description |
|-------|------|-------------|
| id | string | Unique identifier for the content |
| title | string | Title of the content |
| description | string | Description of the content |
| type | string | Type of media (image, audio, video, text, other) |
| createdAt | string | ISO 8601 date when the content was created |
| sasUrl | string/null | Secure URL to access the media file |
| previewUrl | string/null | URL to access the preview/thumbnail |

#### Video Content Structure
For video content, the response includes:
- **sasUrl**: Link to the video file
- **previewUrl**: Link to the video thumbnail

#### Image Content Structure
For image content, the response includes:
- **sasUrl**: Link to the image file
- **previewUrl**: Link to the image thumbnail (if available)

### 2. Get My Images
Retrieves paginated list of images generated by the user.

```
GET /api/media/my-images?page={page}&limit={limit}
```

#### Query Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| page | integer | No | Page number (default: 1) |
| limit | integer | No | Number of items per page (default: 10, max: 100) |

#### Response
```json
{
  "data": [
    {
      "id": "string",
      "prompt": "string",
      "createdAt": "2023-01-01T00:00:00.000Z",
      "expiresAt": "2023-02-01T00:00:00.000Z",
      "url": "string"
    }
  ],
  "total": 100,
  "page": 1,
  "limit": 10,
  "totalPages": 10
}
```

#### Response Fields
| Field | Type | Description |
|-------|------|-------------|
| data | array | Array of image objects |
| total | integer | Total number of images |
| page | integer | Current page number |
| limit | integer | Number of items per page |
| totalPages | integer | Total number of pages |

#### Image Object Fields
| Field | Type | Description |
|-------|------|-------------|
| id | string | Unique identifier for the image |
| prompt | string | Prompt used to generate the image |
| createdAt | string | ISO 8601 date when the image was created |
| expiresAt | string | ISO 8601 date when the image will expire |
| url | string | Secure URL to access the image file |

## Video Content Details
Videos in the gallery include the following components:
1. **Video File**: The main video file (accessible via sasUrl)
2. **Audio File**: The voice narration track (included in the video or as a separate file)
3. **Script**: The text script used for the voice narration (stored in the content description)
4. **SRT Subtitles**: Subtitle file in SRT format (accessible via a separate endpoint or included in the video)

## Image Content Details
Images in the gallery include:
1. **Image File**: The generated image file (accessible via sasUrl)
2. **Prompt**: The prompt used to generate the image (included in the prompt field)
3. **Preview**: Thumbnail of the image (accessible via previewUrl)

## Error Responses
All endpoints may return the following error responses:

### 401 Unauthorized
```json
{
  "statusCode": 401,
  "message": "Unauthorized"
}
```

### 403 Forbidden
```json
{
  "statusCode": 403,
  "message": "You do not have permission to access the gallery."
}
```

### 500 Internal Server Error
```json
{
  "statusCode": 500,
  "message": "Internal server error"
}
```

## Rate Limiting
The API implements rate limiting to prevent abuse. If you exceed the limit, you'll receive a 429 status code.

## Best Practices

1. **Token Management**: Always store tokens securely and refresh them before they expire
2. **Pagination**: Use pagination for large datasets to improve performance
3. **Caching**: Cache gallery data when appropriate to reduce API calls
4. **Error Handling**: Implement comprehensive error handling for all API calls
5. **Loading States**: Show loading indicators during API requests
6. **Security**: Never expose tokens in client-side code or logs

## Example Usage (JavaScript)

```javascript
// Get user gallery
async function getUserGallery(token) {
  try {
    const response = await fetch('/api/gallery', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
      },
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const gallery = await response.json();
    return gallery;
  } catch (error) {
    console.error('Error fetching gallery:', error);
    throw error;
  }
}

// Get my images with pagination
async function getMyImages(token, page = 1, limit = 10) {
  try {
    const response = await fetch(`/api/media/my-images?page=${page}&limit=${limit}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
      },
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const images = await response.json();
    return images;
  } catch (error) {
    console.error('Error fetching images:', error);
    throw error;
  }
}
```